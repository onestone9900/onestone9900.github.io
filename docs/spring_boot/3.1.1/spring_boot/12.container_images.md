---
layout: default
title: 12. 컨테이너 이미지(Container Images)
parent: SpringBootReference
grand_parent: 3.1.1
nav_order: 12
---

***

12. 컨테이너 이미지(Container Images)
    - 12.1. 효율적인 컨테이너 이미지(Efficient Container Images)
        - 12.1.1. 도커 이미지 계층(Layering Docker Images)
    - 12.2. Dockerfiles
    - 12.3. Cloud Native Buildpacks
    - 12.4. What to Read Next

***


# 12. 컨테이너 이미지(Container Images)
스프링 부트 애플리케이션은 `Dockerfile`을 사용하거나 `Cloud Native Buildpack`을 사용하여 어디서나 실행할 수 있는 최적화된 도커 컨테이너 이미지를 생성하여 컨테이너화할 수 있다.


## 12.1. 효율적인 컨테이너 이미지(Efficient Container Images)
스프링 부트 fat jar를 도커 이미지로 패키징하는 것은 쉽다. 그러나 도커 이미지에서와 같이 fat jar를 복사하고 실행하는 데 여러 단점이 있다. 언패킹(unpacking)을 없이 Fat Jar를 실행하는 경우 항상 일정량의 오버헤드가 발생하며, 컨테이너화된 환경에서는 이것이 눈에 띄게 나타날 수 있다. 또 다른 문제는 애플리케이션의 코드와 모든 의존성을 도커 이미지의 한 레이어에 배치하는 것이다. 사용하는 스프링 부트 버전을 업그레이드하는 것보다 코드를 더 자주 재컴파일할 수 있으므로 항목을 좀 더 분리하는 것이 더 나은 경우가 많다. 애플리케이션 클래스 이전 계층에 jar 파일을 배치하는 경우 도커는 맨 아래 계층만 변경하면 되고 캐시에서 다른 계층을 선택할 수 있는 경우가 많다.


### 12.1.1. 도커 이미지 계층화(Layering Docker Images)
최적화된 도커 이미지를 더 쉽게 생성할 수 있도록 스프링 부트는 jar에 계층 인덱스 파일 추가를 지원한다. 이는 계층 목록과 그 안에 포함되어야 하는 jar를 제공한다. 인덱스의 계층 목록은 계층이 Docker/OCI 이미지에 추가되어야 하는 순서에 따라 정렬된다. 기본적으로 다음 계층이 지원된다.

- 의존성(dependencies) (정기적으로 릴리스된 의존성의 경우)
- spring-boot-loader (org/springframework/boot/loader 아래의 모든 항목에 대해)
- snapshot-dependencies (스냅샷 의존성)
- application (애플리케이션 클래스 및 리소스)


다음은layer.idx 파일의 예를 보여준다.
```
- "dependencies":
    - BOOT-INF/lib/library1.jar
    - BOOT-INF/lib/library2.jar
  - "spring-boot-loader":
    - org/springframework/boot/loader/JarLauncher.class
    - org/springframework/boot/loader/jar/JarEntry.class
  - "snapshot-dependencies":
    - BOOT-INF/lib/library3-SNAPSHOT.jar
  - "application":
    - META-INF/MANIFEST.MF
    - BOOT-INF/classes/a/b/C.class
```

이 계층화는 애플리케이션 빌드 간 변경 가능성에 따라 코드를 분리하도록 설계됐다. 라이브러리 코드는 빌드 간 변경될 가능성이 적으므로, 라이브러리가 캐시의 계층을 재사용할 수 있도록 자체 계층에 배치된다. 애플리케이션 코드는 빌드 간 변경될 가능성이 높으므로 별도의 계층에 격리된다.

스프링 부트는 또한 layers.idx의 도움으로 war 파일에 대한 계층화를 지원한다.

메이블의 경우 압축파일에 계층 인덱스를 추가하는 방법에 대한 자세한 내용은 패키징 계층 jar 또는 war 장을 참고하자. 그레이들의 경우 그레이들 플러그인 문서의 패키징 계층 jar 또는 war 장을 참고하자.

For Maven, see the packaging layered jar or war section for more details on adding a layer index to the archive. For Gradle, see the packaging layered jar or war section of the Gradle plugin documentation.